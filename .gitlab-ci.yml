variables:
  GIT_SUBMODULE_STRATEGY: recursive

stages:
  - build
  - build_examples
  - test

build_skepu:
  stage: build
  artifacts:
    paths:
      - skepu
  script:
    - make
    - make skepu
  only:
    - merge_requests

build_examples:
  stage: build_examples
  dependencies:
    - build_skepu
  artifacts:
    paths:
      - examples/sequential
      - examples/parallel
  script:
    - cd examples
    - make all-sequential
    - make all-parallel
  only:
    - merge_requests

test_skepu:
  stage: test
  dependencies:
    - build_skepu
  script:
    - skepu/bin/skepu-tool --help
  only:
    - merge_requests
